# Troubleshooting Guide â€” udemy-hp

> Last updated: 2026-02-17

---

## Table of Contents

1. [pnpm Install Failures](#1-pnpm-install-failures)
2. [Dev Server Issues](#2-dev-server-issues)
3. [Build Failures](#3-build-failures)
4. [Import Path Problems](#4-import-path-problems)
5. [Svelte 5 Gotchas](#5-svelte-5-gotchas)
6. [TypeScript Errors](#6-typescript-errors)
7. [GSAP SSR Issues](#7-gsap-ssr-issues)
8. [ScrollTrigger Positioning Problems](#8-scrolltrigger-positioning-problems)
9. [Phosphor Icon Imports](#9-phosphor-icon-imports)
10. [CSS Scoping Issues](#10-css-scoping-issues)
11. [Font Loading Problems](#11-font-loading-problems)
12. [Prerender 404 Errors](#12-prerender-404-errors)

---

## 1. pnpm Install Failures

### 1a. Lockfile Version Mismatch

**Symptom:**
```
ERR_PNPM_LOCKFILE_BREAKING_CHANGE  The lockfile was generated by a newer version of pnpm
```

**Cause:** Your local pnpm version is older than the version that generated `pnpm-lock.yaml`.

**Fix:**
```bash
# Update pnpm to latest
corepack enable
corepack prepare pnpm@latest --activate

# Or use npm
npm install -g pnpm@latest

# Then reinstall
pnpm install
```

**Prevention:** Pin the pnpm version in `package.json` using the `packageManager` field:
```json
{
  "packageManager": "pnpm@10.x.x"
}
```

---

### 1b. Node Version Incompatibility

**Symptom:**
```
ERR_PNPM_UNSUPPORTED_ENGINE  Unsupported Node.js version
```
or peer dependency warnings mentioning Node version.

**Cause:** SvelteKit 2 / Vite 7 requires Node.js >= 20.

**Fix:**
```bash
# Check current version
node -v

# Use nvm to switch
nvm install 20
nvm use 20

# Reinstall
rm -rf node_modules
pnpm install
```

**Prevention:** Add an `.nvmrc` file:
```
20
```

---

### 1c. Phantom Dependencies / Workspace Issues

**Symptom:**
```
ERR_PNPM_PEER_DEP_ISSUES  Unmet peer dependencies
```

**Cause:** The project uses `pnpm-workspace.yaml` which can create strict dependency resolution.

**Fix:**
```bash
# Clean slate install
rm -rf node_modules .svelte-kit
pnpm install --force
```

**Prevention:** Keep `pnpm-workspace.yaml` accurate. If this is a monorepo, ensure shared dependencies are hoisted correctly.

---

## 2. Dev Server Issues

### 2a. Port Already in Use

**Symptom:**
```
Error: listen EADDRINUSE :::5173
```

**Cause:** Another process is using port 5173.

**Fix:**
```bash
# Find the process
lsof -i :5173

# Kill it
kill -9 <PID>

# Or use a different port
pnpm dev -- --port 3000
```

**Prevention:** Close previous dev server instances before starting a new one.

---

### 2b. HMR Not Working / Stale State

**Symptom:** Changes to `.svelte` files do not appear in the browser. The page does not hot-reload.

**Cause:** Vite's module graph can become stale, or the `.svelte-kit` directory is corrupted.

**Fix:**
```bash
# Clear SvelteKit generated files and restart
rm -rf .svelte-kit
pnpm dev
```

If that does not help:
```bash
# Full reset
rm -rf .svelte-kit node_modules/.vite
pnpm dev
```

**Prevention:** Avoid editing files outside the `src/` directory while the dev server is running.

---

### 2c. "Cannot find module" During Dev

**Symptom:**
```
Error: Cannot find module '$components/Nav.svelte'
```

**Cause:** SvelteKit aliases are not synced. The `.svelte-kit/tsconfig.json` is stale.

**Fix:**
```bash
# Re-sync SvelteKit
pnpm prepare
# Then restart dev server
pnpm dev
```

**Prevention:** Run `pnpm prepare` after modifying `svelte.config.js` aliases.

---

## 3. Build Failures

### 3a. Type Errors Blocking Build

**Symptom:**
```
error TS2345: Argument of type 'string' is not assignable to parameter of type ...
```

**Cause:** `svelte-check` runs during build and finds TypeScript errors.

**Fix:**
```bash
# Check for type errors first
pnpm check

# Fix the reported errors, then build
pnpm build
```

**Prevention:** Run `pnpm check` before committing. Consider adding it to a pre-commit hook.

---

### 3b. Build OOM (Out of Memory)

**Symptom:**
```
FATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory
```

**Cause:** Large project or complex GSAP imports consuming too much memory during build.

**Fix:**
```bash
# Increase Node memory
NODE_OPTIONS="--max-old-space-size=4096" pnpm build
```

**Prevention:** Tree-shake GSAP imports. Only import what you use:
```js
// Good
import { gsap } from 'gsap';
import { ScrollTrigger } from 'gsap/ScrollTrigger';

// Bad (imports everything)
import gsap from 'gsap/all';
```

---

### 3c. Adapter Build Errors

**Symptom:**
```
@sveltejs/adapter-auto could not determine which adapter to use
```

**Cause:** `adapter-auto` detects the deployment platform at build time. If building locally without a platform, it falls back or fails.

**Fix:**
```bash
# Install a specific adapter
pnpm add -D @sveltejs/adapter-static
# or
pnpm add -D @sveltejs/adapter-vercel
# or
pnpm add -D @sveltejs/adapter-netlify
```

Then update `svelte.config.js`:
```js
import adapter from '@sveltejs/adapter-static';
```

**Prevention:** Switch to a specific adapter before production deployment instead of relying on `adapter-auto`.

---

## 4. Import Path Problems

### 4a. Alias Not Resolved

**Symptom:**
```
Cannot find module '$components/Button.svelte' or its corresponding type declarations
```

**Cause:** The path aliases defined in `svelte.config.js` are not picked up by TypeScript or Vite.

**Fix:**

The project defines these aliases in `svelte.config.js`:
```js
alias: {
  $components: './src/lib/components',
  $assets: './src/lib/assets',
  $lib: './src/lib',
  $utils: './src/lib/utils',
  $types: './src/lib/types'
}
```

Ensure `.svelte-kit/tsconfig.json` is generated:
```bash
pnpm prepare
```

If the IDE still shows errors, restart the TypeScript language server.

**Prevention:** Always run `pnpm prepare` after changing aliases. Use the `$lib` alias as the base (it is built into SvelteKit).

---

### 4b. Circular Imports

**Symptom:** Runtime error or empty imports. Components render as `undefined`.

**Cause:** File A imports from File B, which imports from File A.

**Fix:** Identify the cycle and refactor. Common pattern:
```
components/index.ts -> imports Card.svelte
Card.svelte -> imports from components/index.ts  (CIRCULAR)
```

Solution: Import directly from the file instead of the barrel:
```js
// Instead of: import { Button } from '$components';
// Use: import Button from '$components/Button.svelte';
```

**Prevention:** Be cautious with barrel exports (`index.ts`) in component directories. Avoid re-exporting components that import from the same barrel.

---

### 4c. mdsvex Import Issues

**Symptom:** `.svx` files are not recognized or fail to import.

**Cause:** The `extensions` config in `svelte.config.js` may not include `.svx`, or mdsvex is not in the preprocessor chain.

**Fix:** Verify `svelte.config.js`:
```js
preprocess: [vitePreprocess(), mdsvex()],
extensions: ['.svelte', '.svx']
```

**Prevention:** Always include `.svx` in the `extensions` array when using mdsvex.

---

## 5. Svelte 5 Gotchas

### 5a. Using `$state` Outside of Components

**Symptom:**
```
$state(...) can only be used as a variable declaration initializer
```

**Cause:** Svelte 5 runes (`$state`, `$derived`, `$effect`) can only be used in `.svelte` or `.svelte.ts` files.

**Fix:** Rename the file:
```
stores/counter.ts  ->  stores/counter.svelte.ts
```

Or use the non-rune API for plain `.ts` files.

**Prevention:** Use the `.svelte.ts` extension for any TypeScript file that uses runes.

---

### 5b. Accidental Mutation of `$state` Objects

**Symptom:** UI does not update when you push to a `$state` array or modify a nested object property.

**Cause:** In Svelte 5, `$state` uses proxies for reactivity. Some patterns break the proxy.

**Fix:**
```js
// WRONG: Destructuring breaks reactivity
let { items } = $state({ items: [] });
items.push('new'); // Does NOT trigger update

// RIGHT: Keep the state object intact
let state = $state({ items: [] });
state.items = [...state.items, 'new']; // Triggers update
// OR
state.items.push('new'); // This DOES work in Svelte 5 with proxies
```

**Prevention:** Read the Svelte 5 reactivity documentation. Avoid destructuring `$state` objects.

---

### 5c. `$effect` Running on Server

**Symptom:**
```
$effect can only be used during component initialisation
```

**Cause:** `$effect` was called outside a component context, or in a server-rendered context.

**Fix:**
```js
import { browser } from '$app/environment';

$effect(() => {
  if (!browser) return;
  // DOM-dependent code here
});
```

**Prevention:** Always guard browser-only code with the `browser` check from `$app/environment`.

---

### 5d. Slots Replaced by Snippets

**Symptom:**
```
<slot> is no longer supported. Use {@render children()} instead.
```

**Cause:** Svelte 5 replaced `<slot>` with snippets.

**Fix:**
```svelte
<!-- OLD (Svelte 4) -->
<slot />
<slot name="header" />

<!-- NEW (Svelte 5) -->
<script>
  let { children, header } = $props();
</script>
{@render children?.()}
{@render header?.()}
```

**Prevention:** Use the Svelte 5 migration guide. Search the codebase for `<slot` and replace.

---

## 6. TypeScript Errors

### 6a. Missing Component Prop Types

**Symptom:**
```
Property 'title' does not exist on type ...
```

**Cause:** Props not declared with `$props()` or types not defined.

**Fix:**
```svelte
<script lang="ts">
  interface Props {
    title: string;
    description?: string;
  }
  let { title, description = '' }: Props = $props();
</script>
```

**Prevention:** Always define an interface for component props and type the `$props()` destructuring.

---

### 6b. `svelte-check` Reports Errors Not in IDE

**Symptom:** `pnpm check` fails but VS Code shows no errors.

**Cause:** The IDE TypeScript version differs from the project's, or `.svelte-kit/tsconfig.json` is stale.

**Fix:**
```bash
pnpm prepare
pnpm check
```

In VS Code, set TypeScript version to workspace version:
1. Open a `.ts` file
2. Click TypeScript version in the bottom status bar
3. Select "Use Workspace Version"

**Prevention:** Keep IDE extensions updated. Use the Svelte extension for VS Code.

---

### 6c. Generic Type Errors with Event Handlers

**Symptom:**
```
Type 'Event' is not assignable to type 'MouseEvent'
```

**Cause:** Svelte 5 event handlers use different typing than Svelte 4.

**Fix:**
```svelte
<!-- Svelte 5 uses standard HTML event attributes -->
<button onclick={(e: MouseEvent) => handleClick(e)}>Click</button>
```

**Prevention:** Use the native event attribute names (`onclick`, `onsubmit`) instead of the Svelte 4 `on:click` syntax.

---

## 7. GSAP SSR Issues

### 7a. "window is not defined"

**Symptom:**
```
ReferenceError: window is not defined
```

**Cause:** GSAP accesses `window` and `document` at import time. During SSR (server-side rendering), these globals do not exist.

**Fix:**

Use dynamic import guarded by browser check:
```js
// src/lib/utils/gsap.ts
import { browser } from '$app/environment';

export async function initGSAP() {
  if (!browser) return;

  const { gsap } = await import('gsap');
  const { ScrollTrigger } = await import('gsap/ScrollTrigger');
  gsap.registerPlugin(ScrollTrigger);

  return { gsap, ScrollTrigger };
}
```

In components:
```svelte
<script>
  import { onMount } from 'svelte';

  onMount(async () => {
    const { gsap } = await import('gsap');
    gsap.to('.hero', { opacity: 1, duration: 1 });
  });
</script>
```

**Prevention:** NEVER import GSAP at the top level of a module that runs during SSR. Always use dynamic imports or `onMount`.

---

### 7b. GSAP Plugins Not Registered

**Symptom:**
```
GSAP target not found
```
or ScrollTrigger does not fire at all.

**Cause:** `gsap.registerPlugin(ScrollTrigger)` was not called before using ScrollTrigger.

**Fix:**
```js
import { gsap } from 'gsap';
import { ScrollTrigger } from 'gsap/ScrollTrigger';

gsap.registerPlugin(ScrollTrigger);
```

**Prevention:** Create a single initialization utility (like `src/lib/utils/gsap.ts`) that registers all plugins, and import from there.

---

## 8. ScrollTrigger Positioning Problems

### 8a. Trigger Fires at Wrong Scroll Position

**Symptom:** Animations trigger too early, too late, or not at all.

**Cause:** ScrollTrigger calculates positions on page load. If images load late or layout shifts, positions are wrong.

**Fix:**
```js
// Refresh ScrollTrigger after all content loads
onMount(() => {
  // Wait for images
  window.addEventListener('load', () => {
    ScrollTrigger.refresh();
  });

  // Or use a timeout as fallback
  setTimeout(() => ScrollTrigger.refresh(), 1000);
});
```

**Prevention:** Set explicit `width` and `height` on images to prevent layout shift. Call `ScrollTrigger.refresh()` after dynamic content loads.

---

### 8b. ScrollTrigger Persists After Navigation

**Symptom:** Animations fire on the wrong page, or multiple triggers stack up.

**Cause:** ScrollTrigger instances are not cleaned up when SvelteKit navigates between pages.

**Fix:**
```svelte
<script>
  import { onMount } from 'svelte';

  onMount(() => {
    const trigger = ScrollTrigger.create({
      trigger: '.section',
      start: 'top center',
      onEnter: () => { /* ... */ }
    });

    // Cleanup on component destroy
    return () => {
      trigger.kill();
    };
  });
</script>
```

**Prevention:** Always return a cleanup function from `onMount` that calls `.kill()` on all ScrollTrigger instances.

---

### 8c. ScrollTrigger and `markers: true` in Production

**Symptom:** Debug markers visible in production build.

**Cause:** `markers: true` was left in the ScrollTrigger config.

**Fix:**
```js
ScrollTrigger.create({
  trigger: '.section',
  markers: import.meta.env.DEV, // Only show in dev
  start: 'top center'
});
```

**Prevention:** Use `import.meta.env.DEV` for debug flags, or remove `markers` entirely before production.

---

## 9. Phosphor Icon Imports

### 9a. Icon Not Rendering

**Symptom:** Component renders but the icon is blank or missing.

**Cause:** Incorrect import path. `phosphor-svelte` v3 uses a different import structure.

**Fix:**
```svelte
<!-- Correct import for phosphor-svelte v3 -->
<script>
  import IconArrowRight from 'phosphor-svelte/lib/ArrowRight';
</script>

<IconArrowRight size={24} />
```

Or using the named export:
```svelte
<script>
  import { ArrowRight } from 'phosphor-svelte';
</script>

<ArrowRight size={24} />
```

**Prevention:** Check the `phosphor-svelte` documentation for the correct import syntax for your installed version.

---

### 9b. Large Bundle from Phosphor Icons

**Symptom:** Bundle size increases significantly after adding icons.

**Cause:** Importing from the package barrel (`phosphor-svelte`) can include all icons if tree-shaking fails.

**Fix:**
```js
// Use direct imports for better tree-shaking
import ArrowRight from 'phosphor-svelte/lib/ArrowRight';
import House from 'phosphor-svelte/lib/House';
```

**Prevention:** Always prefer direct path imports over barrel imports for icon libraries.

---

### 9c. SSR Error with Phosphor Icons

**Symptom:**
```
Cannot read properties of undefined (reading 'createElementNS')
```

**Cause:** The icon component tries to render SVG during SSR but the DOM API is not available.

**Fix:** This is usually handled by SvelteKit automatically. If it occurs, ensure you are using `phosphor-svelte` v3 which supports SSR.

```bash
pnpm update phosphor-svelte
```

**Prevention:** Keep `phosphor-svelte` updated. v3 has proper SSR support for Svelte 5.

---

## 10. CSS Scoping Issues

### 10a. Styles Not Applying to Child Components

**Symptom:** CSS written in a parent component does not affect child component elements.

**Cause:** Svelte scopes CSS to the component by default. Styles do not leak into child components.

**Fix:**
```svelte
<style>
  /* Use :global() to target child component elements */
  .parent :global(.child-class) {
    color: red;
  }
</style>
```

**Prevention:** Design components to accept styling props or CSS custom properties instead of relying on parent CSS leaking in.

---

### 10b. Global Styles Overridden by Scoped Styles

**Symptom:** Styles in `app.css` are overridden by component styles unexpectedly.

**Cause:** Svelte scoped styles have higher specificity due to the generated class attribute.

**Fix:** Increase specificity in `app.css`:
```css
/* In app.css, use more specific selectors */
body .target-class {
  color: blue;
}
```

Or use `!important` sparingly for resets/base styles.

**Prevention:** Use `app.css` only for CSS custom properties (variables), resets, and font-face declarations. Keep component-specific styles in components.

---

### 10c. Unused CSS Warning

**Symptom:**
```
Unused CSS selector ".my-class"
```

**Cause:** Svelte detects that a CSS selector in `<style>` does not match any element in the component template.

**Fix:**
- If the class is applied dynamically: use `:global(.my-class)` or suppress with a comment
- If the class is truly unused: remove it

```svelte
<style>
  /* Applied via GSAP or JS, so Svelte can't detect it */
  :global(.gsap-animated) {
    opacity: 0;
  }
</style>
```

**Prevention:** Use `:global()` for classes that are applied programmatically (e.g., by GSAP).

---

## 11. Font Loading Problems

### 11a. FOUT (Flash of Unstyled Text)

**Symptom:** Text briefly displays in a fallback font before the custom font loads.

**Cause:** The custom font is not preloaded, so the browser renders the fallback first.

**Fix:**

Add font preload in `src/app.html`:
```html
<head>
  <link rel="preload" href="/fonts/your-font.woff2" as="font" type="font/woff2" crossorigin />
</head>
```

Use `font-display: swap` in `@font-face`:
```css
@font-face {
  font-family: 'YourFont';
  src: url('/fonts/your-font.woff2') format('woff2');
  font-display: swap;
}
```

**Prevention:** Always preload critical fonts. Use `woff2` format for best compression.

---

### 11b. Font Not Loading in Production

**Symptom:** Fonts work in dev but not after build/deploy.

**Cause:** Font files are not in the `static/` directory, or the path is wrong in production.

**Fix:**
- Place font files in `/static/fonts/`
- Reference them with absolute paths: `url('/fonts/your-font.woff2')`
- Do NOT use relative paths like `url('./fonts/...')` in CSS

**Prevention:** Always place static assets in the `static/` directory and reference with absolute paths starting with `/`.

---

### 11c. Fonts Not Loading from `src/lib/assets`

**Symptom:** Font imports from `$assets` fail or produce incorrect URLs.

**Cause:** Vite processes assets in `src/lib/assets` differently than static files. Fonts should generally be in `static/`.

**Fix:** Move fonts to `static/fonts/` and reference with `/fonts/filename.woff2`.

**Prevention:** Use `static/` for fonts and other assets that do not need Vite processing.

---

## 12. Prerender 404 Errors

### 12a. Blog/Case Study Links Cause Prerender Failure

**Symptom:**
```
404 /blog/some-post (linked from /blog)
```

**Cause:** The blog listing page links to `/blog/some-post`, but there is no corresponding `+page.svelte` or `+page.svx` file at that route.

**Fix:** The project already handles this in `svelte.config.js`:
```js
prerender: {
  handleHttpError: ({ path, referrer, message }) => {
    if (path.startsWith('/blog/') || path.startsWith('/case-studies/') || path === '/favicon.svg') {
      console.warn(`Warning: ${message} (linked from ${referrer})`);
      return; // Ignore instead of throwing
    }
    throw new Error(message);
  }
}
```

To properly fix: Create the actual route files for each blog post and case study.

**Prevention:** Do not link to pages that do not exist. Use data-driven routes with `+page.ts` load functions and `entries()` for prerendering.

---

### 12b. Dynamic Routes Not Prerendered

**Symptom:** Dynamic routes (e.g., `/blog/[slug]`) return 404 in the static build.

**Cause:** `adapter-static` or prerendering does not know which slugs to generate.

**Fix:** Add an `entries` function to the route's `+page.ts`:
```ts
// src/routes/blog/[slug]/+page.ts
import { blogPosts } from '$lib/data/blog-posts';

export function entries() {
  return blogPosts.map((post) => ({ slug: post.slug }));
}

export const prerender = true;
```

**Prevention:** Always define `entries()` for dynamic routes that need to be prerendered.

---

### 12c. Favicon 404 During Prerender

**Symptom:**
```
404 /favicon.svg
```

**Cause:** The HTML references `/favicon.svg` but during prerender the file is not served.

**Fix:** Already handled by the `handleHttpError` config. The favicon exists at `static/favicon.svg` and will be available in the final build. Also verify in `src/app.html`:
```html
<link rel="icon" href="/favicon.svg" type="image/svg+xml" />
```

**Prevention:** Ensure favicon files are in the `static/` directory.

---

## Quick Reference: Common Commands

```bash
# Full reset when things go wrong
rm -rf node_modules .svelte-kit && pnpm install && pnpm prepare

# Check for type errors
pnpm check

# Check for lint/format issues
pnpm lint

# Verify build works
pnpm build && pnpm preview

# Run all tests
pnpm test

# Debug a specific E2E test
npx playwright test e2e/demo.test.js --headed --debug
```
